METHODOLOGY
입력 이미지 분할
입력 이미지를 448×448 크기의 패치로 슬라이딩 윈도우 방식으로 나눔.
각 패치는 다시 14×14 픽셀의 작은 패치로 세분화되어 각각이 토큰으로 처리

로컬 특징 추출
사전학습된 CLIP 기반 Transformer 블록을 활용해, 각 패치 내 토큰들을 개별적으로 처리.
윈도우 간 문맥을 연결하기 위해 Shifted Window Attention을 일정 간격으로 적용.

전역 특징 추출
입력 이미지를 448×448 크기로 리사이즈하여 CLIP에 입력, 글로벌 특징을 추출.
이 전역 특징은 서브이미지에서 얻은 특징과 함께 공유 이미지 리샘플러로 처리되어 언어 도메인과 정렬됨.

토큰 압축 및 정제
Token Resampler를 사용해 토큰 길이를 줄이고, 언어 공간에서의 중복 최소화.

최종 답변 생성
이렇게 처리된 시각 특징들과 입력 질문이 결합되어 LLM이 분석, 원하는 답변을 생성.

### 3.1 Shifted Window Attention

1. **문제 배경**
    - 문서 이해에서는 입력 해상도가 매우 중요.
    - 기존 방법은 **슬라이딩 윈도우**로 이미지를 잘라서 처리 → 자연 장면에는 효과적이지만,
        - 문서 내 **연결된 텍스트가 단절**되는 문제 발생.
        - *텍스트 위치 기반 태스크(예: grounding)**에 불리.
2. **해결 방법: Shifted Window Attention (SWA)**
    - 이미지를 **비중첩(non-overlapping) 윈도우**로 분할.
    - 각 윈도우는 CLIP Transformer 블록으로 처리하되, 기본적으로 **윈도우 간 상호작용 없음**.
    - SWA를 적용하여 윈도우를 **주기적으로 좌상단(top-left) 방향으로 shift** → 새로운 윈도우 구성.
    - **마스킹된 self-attention**을 적용 → 새로운 윈도우 내에서만 attention 계산.
    - 이로써 **윈도우 간 문맥 정보 공유**가 가능해져, 의미적 연속성 확보.
3. **훈련 안정화 기법 (Zero Initialization)**
    - 문제: 초기 학습 단계에서 과도한 변형이 발생하면 학습 불안정.
    - 해결책: **MLP 초기화 방식을 변경**.
        - 일반적으로는 두 개의 선형 계층 A,BA, BA,B의 가중치를 랜덤 초기화.
        - 여기서는 **A는 Gaussian 랜덤 초기화**, **B는 0 초기화**.
    - 수식:x=BAx^
        
        x=BAx^x = \mathbf{B} A \hat{x}
        
        - B = 0에서 시작 → 초기에는 출력이 안정적.
        - 학습이 진행되면서 점진적으로 특징 변환 학습.
    - 결과적으로 **학습 초기의 안정성**을 보장하고 smoother한 학습 진행 가능.

3.2 Image Resampler
목적: **이미지 특징의 중복(redundancy)을 줄이고**, 일정한 길이로 압축하기 위해 사용

- **입력**:
    - Swin/CLIP 같은 비전 인코더에서 나온 이미지 피처 시퀀스 (H×WH \times WH×W 크기 토큰).
    - 보통 토큰 수가 많아 → redundancy 존재.
- **Query (Q)**:
    - 미리 학습 가능한 파라미터 집합으로 정의된 **고정된 개수의 query 벡터**.
    - 예: 길이 256개의 learnable query.
- **Key (K), Value (V)**:
    - 비전 인코더에서 나온 이미지 피처.
- **Cross-Attention 수행**:
    - Query ↔ Key, Value를 연결해서 attention.
    - Query들이 "이미지 전체 피처에서 중요한 정보만 요약"하는 역할.
    - 결과: Query 개수(256개)만큼의 압축된 피처 시퀀스 생성.
- **Positional Encoding 추가**:
    - 단순히 요약하면 위치 정보가 손실되므로,
    - **2D 절대 positional encoding**을 Q-K 페어에 넣어 fine-grained 위치 정보 유지.
